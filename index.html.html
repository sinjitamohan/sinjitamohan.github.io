<html>
<head>
<title>index.html</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #d5b778;}
.s1 { color: #bcbec4;}
.s2 { color: #bababa;}
.s3 { color: #6aab73;}
.s4 { color: #2aacb8;}
.s5 { color: #7a7e85;}
.s6 { color: #56a8f5;}
.s7 { color: #cf8e6d;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
index.html</font>
</center></td></tr></table>
<pre><span class="s0">&lt;!DOCTYPE </span><span class="s2">html</span><span class="s0">&gt;</span>
<span class="s0">&lt;html </span><span class="s2">lang</span><span class="s3">=&quot;en&quot;</span><span class="s0">&gt;</span>
<span class="s0">&lt;head&gt;</span>
    <span class="s0">&lt;meta </span><span class="s2">charset</span><span class="s3">=&quot;UTF-8&quot;</span><span class="s0">&gt;</span>
    <span class="s0">&lt;meta </span><span class="s2">name</span><span class="s3">=&quot;viewport&quot; </span><span class="s2">content</span><span class="s3">=&quot;width=device-width, initial-scale=1.0&quot;</span><span class="s0">&gt;</span>
    <span class="s0">&lt;title&gt;</span><span class="s1">Model Prediction</span><span class="s0">&lt;/title&gt;</span>
    <span class="s0">&lt;script </span><span class="s2">src</span><span class="s3">=&quot;https://cdn.jsdelivr.net/npm/@tensorflow/tfjs&quot;</span><span class="s0">&gt;&lt;/script&gt;</span>
    <span class="s0">&lt;style&gt;</span>
        <span class="s0">body </span><span class="s1">{</span>
            <span class="s2">display</span><span class="s1">: </span><span class="s3">flex</span><span class="s1">;</span>
            <span class="s2">flex-direction</span><span class="s1">: </span><span class="s3">column</span><span class="s1">;</span>
            <span class="s2">align-items</span><span class="s1">: </span><span class="s3">center</span><span class="s1">;</span>
            <span class="s2">justify-content</span><span class="s1">: </span><span class="s3">center</span><span class="s1">;</span>
            <span class="s2">min-height</span><span class="s1">: </span><span class="s4">100</span><span class="s3">vh</span><span class="s1">;</span>
            <span class="s2">margin</span><span class="s1">: </span><span class="s4">0</span><span class="s1">;</span>
            <span class="s2">font-family</span><span class="s1">: </span><span class="s0">Arial</span><span class="s1">, </span><span class="s3">sans-serif</span><span class="s1">;</span>
        <span class="s1">}</span>
        <span class="s0">video </span><span class="s1">{</span>
            <span class="s2">max-width</span><span class="s1">: </span><span class="s4">90</span><span class="s1">%;</span>
            <span class="s2">border-radius</span><span class="s1">: </span><span class="s4">15</span><span class="s3">px</span><span class="s1">; </span><span class="s5">/* Rounded corners */</span>
            <span class="s2">box-shadow</span><span class="s1">: </span><span class="s4">0 4</span><span class="s3">px </span><span class="s4">8</span><span class="s3">px </span><span class="s0">rgba</span><span class="s1">(</span><span class="s4">0</span><span class="s1">,</span><span class="s4">0</span><span class="s1">,</span><span class="s4">0</span><span class="s1">,</span><span class="s4">0.2</span><span class="s1">);</span>
        <span class="s1">}</span>
        <span class="s0">button </span><span class="s1">{</span>
            <span class="s2">margin</span><span class="s1">: </span><span class="s4">20</span><span class="s3">px </span><span class="s4">0</span><span class="s1">;</span>
            <span class="s2">padding</span><span class="s1">: </span><span class="s4">10</span><span class="s3">px </span><span class="s4">20</span><span class="s3">px</span><span class="s1">;</span>
            <span class="s2">font-size</span><span class="s1">: </span><span class="s4">16</span><span class="s3">px</span><span class="s1">;</span>
            <span class="s2">cursor</span><span class="s1">: </span><span class="s3">pointer</span><span class="s1">;</span>
            <span class="s2">border</span><span class="s1">: </span><span class="s3">none</span><span class="s1">;</span>
            <span class="s2">border-radius</span><span class="s1">: </span><span class="s4">5</span><span class="s3">px</span><span class="s1">;</span>
            <span class="s2">background-color</span><span class="s1">: </span><span class="s6">#007bff</span><span class="s1">;</span>
            <span class="s2">color</span><span class="s1">: </span><span class="s3">white</span><span class="s1">;</span>
        <span class="s1">}</span>
        <span class="s0">p </span><span class="s1">{</span>
            <span class="s2">font-size</span><span class="s1">: </span><span class="s4">18</span><span class="s3">px</span><span class="s1">;</span>
            <span class="s2">color</span><span class="s1">: </span><span class="s6">#333</span><span class="s1">;</span>
        <span class="s1">}</span>
    <span class="s0">&lt;/style&gt;</span>
<span class="s0">&lt;/head&gt;</span>
<span class="s0">&lt;body&gt;</span>

<span class="s0">&lt;h2&gt;</span><span class="s1">Identify Food</span><span class="s0">&lt;/h2&gt;</span>

<span class="s0">&lt;video </span><span class="s2">id</span><span class="s3">=&quot;video&quot; </span><span class="s2">autoplay playsinline</span><span class="s0">&gt;&lt;/video&gt;</span>
<span class="s5">&lt;!--&lt;button onclick=&quot;switchCamera()&quot;&gt;Switch Camera&lt;/button&gt;--&gt;</span>
<span class="s0">&lt;p </span><span class="s2">id</span><span class="s3">=&quot;result&quot;</span><span class="s0">&gt;&lt;/p&gt;</span>

<span class="s0">&lt;script&gt;</span>
    <span class="s5">////////////////////////////////</span>
    <span class="s5">////////    SPECIFY PARAMETERS</span>
    <span class="s5">////////////////////////////////</span>
    <span class="s7">const </span><span class="s1">PROCESSING_SPEED = </span><span class="s4">2000</span><span class="s1">;</span>
    <span class="s7">const </span><span class="s1">CLASSES = [</span><span class="s3">&quot;Potato&quot;</span><span class="s1">,</span>
        <span class="s3">&quot;Potato | Value per 100g | Cal - 161 | Carbohydrates - 37g | Fat - 0.2g | Protein - 4.3g&quot;</span><span class="s1">,</span>
        <span class="s3">&quot;Apple&quot;</span><span class="s1">,</span>
        <span class="s3">&quot;Apple | Value per 100g | Cal - 95 | carbohydrates - 25g | Fat -0.3g |  Protein - 0.5g&quot;</span><span class="s1">,</span>
        <span class="s3">&quot;Orange&quot;</span><span class="s1">,</span>
        <span class="s3">&quot;Orange | Value per 100g | Cal - 47 | Carbohydrates - 11.7g | Fat - 0.1g |  Protein- 0.9g&quot;</span><span class="s1">,</span>
        <span class="s3">&quot;Onions&quot;</span><span class="s1">,</span>
        <span class="s3">&quot;Onion | Value per 100g | Cal - 44 | Carbohydrates - 10g | Fat - 0.2g |  Protein- 1.4g&quot;</span><span class="s1">,</span>
        <span class="s3">&quot;Carrot&quot;</span><span class="s1">,</span>
        <span class="s3">&quot;Carrot | Value per 100g | Cal - 35 | Carbohydrates - 8.2g | Fat - 0.2g |  Protein- 0.8g&quot;</span><span class="s1">,</span>
        <span class="s3">&quot;Extra&quot;</span><span class="s1">,</span>
        <span class="s3">&quot;Watermelon&quot;</span><span class="s1">,</span>
        <span class="s3">&quot;Watermelon | Value per 100g | Cal - 30 | Carbohydrates - 7.6g | Fat - 0.2g |  Protein- 0.6g&quot;</span><span class="s1">,</span>
        <span class="s3">&quot;Strawberry&quot;</span><span class="s1">,</span>
        <span class="s3">&quot;Strawberry | Value per 100g | Cal - 32 | Carbohydrates - 7.7g | Fat - 0.3g |  Protein - 0.7g&quot;</span><span class="s1">,</span>
        <span class="s3">&quot;Broccoli&quot;</span><span class="s1">,</span>
        <span class="s3">&quot;Broccoli | Value per 100g | Cal - 35 | Carbohydrates - 7.3g | Fat - 0.4g |  Protein - 2.4g&quot;</span><span class="s1">,</span>
        <span class="s3">&quot;Bell pepper&quot;</span><span class="s1">,</span>
        <span class="s3">&quot;Bell pepper | Value per 100g | Cal - 28 | Carbohydrates - 6.6g | Fat - 0.2g |  Protein - 1g&quot;</span><span class="s1">,</span>
        <span class="s3">&quot;Banana&quot;</span><span class="s1">,</span>
        <span class="s3">&quot;Banana | Value per 100g | Cal - 89 | Carbohydrates - 23g | Fat - 0.3g |  Protein - 1.1g&quot;</span><span class="s1">,</span>
    <span class="s1">];</span>
    <span class="s7">const </span><span class="s1">MODEL_FOLDER = </span><span class="s3">'model/model.json'</span><span class="s1">;</span>
    <span class="s5">// const mode = 'environment' // back camera</span>
    <span class="s7">const </span><span class="s1">camera_mode = </span><span class="s3">'user' </span><span class="s5">// front camera</span>

    <span class="s7">let </span><span class="s1">currentStream;</span>

    <span class="s5">////////////////////////////////</span>
    <span class="s5">////////    USE THIS FUNCTION FOR INTERACTIONS</span>
    <span class="s5">////////////////////////////////</span>
    <span class="s7">function </span><span class="s1">interaction(predictedClass, classScores) {</span>
        <span class="s1">console.log(classScores);</span>
        <span class="s1">document.getElementById(</span><span class="s3">&quot;result&quot;</span><span class="s1">).innerHTML = </span><span class="s3">`Prediction: </span><span class="s1">${predictedClass}</span><span class="s3">, Confidence: </span><span class="s1">${classScores[</span><span class="s4">0</span><span class="s1">]}</span><span class="s3">`</span><span class="s1">;</span>
        <span class="s1">document.body.style.backgroundColor = predictedClass === </span><span class="s3">&quot;hat&quot; </span><span class="s1">? </span><span class="s3">&quot;red&quot; </span><span class="s1">: </span><span class="s3">&quot;white&quot;</span><span class="s1">;</span>
    <span class="s1">}</span>

    <span class="s5">////////////////////////////////</span>
    <span class="s5">////////    VIDEO CAPTURE AND PREDICTION LOGIC</span>
    <span class="s5">////////////////////////////////</span>
    <span class="s1">async </span><span class="s7">function </span><span class="s1">startVideo(facingMode = </span><span class="s3">'user'</span><span class="s1">) {</span>
        <span class="s5">// Stop any existing video tracks to free up the camera</span>
        <span class="s7">if </span><span class="s1">(currentStream) {</span>
            <span class="s1">currentStream.getTracks().forEach(track =&gt; {</span>
                <span class="s1">track.stop();</span>
            <span class="s1">});</span>
        <span class="s1">}</span>

        <span class="s7">try </span><span class="s1">{</span>
            <span class="s5">// Request access to the camera with the specified facing mode</span>
            <span class="s7">const </span><span class="s1">stream = await navigator.mediaDevices.getUserMedia({</span>
                <span class="s1">video: { facingMode }</span>
            <span class="s1">});</span>

            <span class="s7">const </span><span class="s1">videoElement = document.getElementById(</span><span class="s3">'video'</span><span class="s1">);</span>
            <span class="s1">videoElement.srcObject = stream;</span>
            <span class="s1">currentStream = stream;</span>

            <span class="s5">// Return a promise that resolves when the video is ready to play</span>
            <span class="s7">return new </span><span class="s1">Promise(resolve =&gt; {</span>
                <span class="s1">videoElement.onloadedmetadata = () =&gt; {</span>
                    <span class="s1">resolve(videoElement);</span>
                <span class="s1">};</span>
            <span class="s1">});</span>
        <span class="s1">} </span><span class="s7">catch </span><span class="s1">(err) {</span>
            <span class="s1">console.error(</span><span class="s3">'Error accessing the camera:'</span><span class="s1">, err);</span>
        <span class="s1">}</span>
    <span class="s1">}</span>


    <span class="s1">async </span><span class="s7">function </span><span class="s1">startPredicting() {</span>
        <span class="s7">const </span><span class="s1">model = await tf.loadGraphModel(MODEL_FOLDER);</span>
        <span class="s1">setInterval(async () =&gt; {</span>
            <span class="s7">const </span><span class="s1">example = tf.browser.fromPixels(video).cast(</span><span class="s3">'float32'</span><span class="s1">);</span>
            <span class="s7">const </span><span class="s1">prediction = await model.predict(example.expandDims());</span>
            <span class="s7">const </span><span class="s1">classScores = await prediction.data();</span>
            <span class="s7">const </span><span class="s1">maxScoreId = classScores.indexOf(Math.max(...classScores));</span>
            <span class="s7">const </span><span class="s1">predictedClass = CLASSES[maxScoreId];</span>

            <span class="s1">interaction(predictedClass, classScores);</span>
        <span class="s1">}, PROCESSING_SPEED);</span>
    <span class="s1">}</span>

    <span class="s5">// function switchCamera() {</span>
    <span class="s5">//     if (currentStream) {</span>
    <span class="s5">//         currentStream.getTracks().forEach(track =&gt; track.stop());</span>
    <span class="s5">//     }</span>
    <span class="s5">//     startVideo('user');</span>
    <span class="s5">// }</span>

    <span class="s1">document.addEventListener(</span><span class="s3">&quot;DOMContentLoaded&quot;</span><span class="s1">, </span><span class="s7">function</span><span class="s1">() {</span>
        <span class="s1">startVideo(camera_mode);</span>
        <span class="s1">startPredicting();</span>
    <span class="s1">});</span>
<span class="s0">&lt;/script&gt;</span>
<span class="s0">&lt;/body&gt;</span>
<span class="s0">&lt;/html&gt;</span>
</pre>
</body>
</html>